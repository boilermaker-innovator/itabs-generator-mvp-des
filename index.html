<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>iTabs Generator - Turn Information Into Action</title>

```
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
    :root {
        --primary: #f59e0b;
        --primary-dark: #d97706;
        --accent: #10b981;
        --bg-dark: #0f172a;
        --bg-card: #1e293b;
        --bg-input: #0f172a;
        --bg-hover: #334155;
        --text-primary: #f1f5f9;
        --text-secondary: #94a3b8;
        --text-muted: #64748b;
        --border: #334155;
        --error: #ef4444;
        --success: #10b981;
    }
    
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
        font-family: 'Inter', sans-serif;
        background: var(--bg-dark);
        color: var(--text-primary);
        min-height: 100vh;
        line-height: 1.6;
    }
    
    .container {
        max-width: 900px;
        margin: 0 auto;
        padding: 20px;
    }
    
    /* Header */
    header {
        text-align: center;
        padding: 40px 20px;
        border-bottom: 1px solid var(--border);
        margin-bottom: 30px;
    }
    
    .logo {
        font-size: 2rem;
        font-weight: 700;
        margin-bottom: 10px;
    }
    
    .logo span {
        background: linear-gradient(135deg, var(--primary), var(--primary-dark));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }
    
    .tagline {
        color: var(--text-secondary);
        font-size: 1.1rem;
    }
    
    /* Steps indicator */
    .steps-indicator {
        display: flex;
        justify-content: center;
        gap: 8px;
        margin-bottom: 30px;
        flex-wrap: wrap;
    }
    
    .step-dot {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: var(--bg-card);
        border: 2px solid var(--border);
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        font-size: 0.9rem;
        color: var(--text-muted);
        transition: all 0.3s;
    }
    
    .step-dot.active {
        background: var(--primary);
        border-color: var(--primary);
        color: var(--bg-dark);
    }
    
    .step-dot.completed {
        background: var(--success);
        border-color: var(--success);
        color: white;
    }
    
    .step-line {
        width: 30px;
        height: 2px;
        background: var(--border);
        align-self: center;
    }
    
    .step-line.completed {
        background: var(--success);
    }
    
    /* Sections */
    .section {
        display: none;
        animation: fadeIn 0.3s ease;
    }
    
    .section.active {
        display: block;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    .section-title {
        font-size: 1.5rem;
        font-weight: 700;
        margin-bottom: 10px;
        color: var(--primary);
    }
    
    .section-desc {
        color: var(--text-secondary);
        margin-bottom: 25px;
    }
    
    /* Cards */
    .card {
        background: var(--bg-card);
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 25px;
        margin-bottom: 20px;
    }
    
    .card-title {
        font-size: 1.1rem;
        font-weight: 600;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .card-title .icon {
        font-size: 1.3rem;
    }
    
    /* Form elements */
    label {
        display: block;
        color: var(--text-secondary);
        font-size: 0.9rem;
        margin-bottom: 8px;
        font-weight: 500;
    }
    
    input[type="text"],
    input[type="url"],
    input[type="email"],
    textarea {
        width: 100%;
        background: var(--bg-input);
        border: 1px solid var(--border);
        border-radius: 8px;
        padding: 14px 16px;
        color: var(--text-primary);
        font-family: 'Inter', sans-serif;
        font-size: 1rem;
        transition: border-color 0.2s;
    }
    
    input:focus,
    textarea:focus {
        outline: none;
        border-color: var(--primary);
    }
    
    textarea {
        min-height: 150px;
        resize: vertical;
    }
    
    .input-help {
        color: var(--text-muted);
        font-size: 0.8rem;
        margin-top: 6px;
    }
    
    /* Buttons */
    .btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        padding: 14px 28px;
        border-radius: 8px;
        font-family: 'Inter', sans-serif;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
        border: none;
    }
    
    .btn-primary {
        background: linear-gradient(135deg, var(--primary), var(--primary-dark));
        color: var(--bg-dark);
    }
    
    .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 20px rgba(245, 158, 11, 0.3);
    }
    
    .btn-primary:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
    }
    
    .btn-secondary {
        background: var(--bg-hover);
        color: var(--text-primary);
        border: 1px solid var(--border);
    }
    
    .btn-secondary:hover {
        background: var(--border);
    }
    
    .btn-success {
        background: var(--success);
        color: white;
    }
    
    .btn-row {
        display: flex;
        gap: 12px;
        margin-top: 25px;
        flex-wrap: wrap;
    }
    
    /* API Key section */
    .api-key-input {
        position: relative;
    }
    
    .api-key-input input {
        padding-right: 50px;
    }
    
    .api-key-toggle {
        position: absolute;
        right: 12px;
        top: 50%;
        transform: translateY(-50%);
        background: none;
        border: none;
        color: var(--text-muted);
        cursor: pointer;
        font-size: 1.2rem;
    }
    
    .api-link {
        color: var(--primary);
        text-decoration: none;
    }
    
    .api-link:hover {
        text-decoration: underline;
    }
    
    /* Chat interface */
    .chat-container {
        background: var(--bg-input);
        border: 1px solid var(--border);
        border-radius: 12px;
        height: 400px;
        display: flex;
        flex-direction: column;
        overflow: hidden;
    }
    
    .chat-messages {
        flex: 1;
        overflow-y: auto;
        padding: 20px;
        display: flex;
        flex-direction: column;
        gap: 15px;
    }
    
    .chat-message {
        max-width: 85%;
        padding: 12px 16px;
        border-radius: 12px;
        font-size: 0.95rem;
        line-height: 1.5;
    }
    
    .chat-message.ai {
        background: var(--bg-card);
        color: var(--text-primary);
        align-self: flex-start;
        border-bottom-left-radius: 4px;
    }
    
    .chat-message.user {
        background: var(--primary);
        color: var(--bg-dark);
        align-self: flex-end;
        border-bottom-right-radius: 4px;
    }
    
    .chat-message.typing::after {
        content: '...';
        animation: dots 1.5s infinite;
    }
    
    @keyframes dots {
        0%, 20% { content: '.'; }
        40% { content: '..'; }
        60%, 100% { content: '...'; }
    }
    
    .chat-input-area {
        padding: 15px;
        border-top: 1px solid var(--border);
        display: flex;
        gap: 10px;
    }
    
    .chat-input {
        flex: 1;
        background: var(--bg-card);
        border: 1px solid var(--border);
        border-radius: 8px;
        padding: 12px 16px;
        color: var(--text-primary);
        font-family: 'Inter', sans-serif;
        font-size: 0.95rem;
        resize: none;
    }
    
    .chat-input:focus {
        outline: none;
        border-color: var(--primary);
    }
    
    .chat-send {
        background: var(--primary);
        border: none;
        border-radius: 8px;
        width: 48px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: transform 0.2s;
    }
    
    .chat-send:hover {
        transform: scale(1.05);
    }
    
    .chat-send svg {
        width: 20px;
        height: 20px;
        fill: var(--bg-dark);
    }
    
    /* Quick replies */
    .quick-replies {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        padding: 0 15px 15px;
    }
    
    .quick-reply {
        background: var(--bg-card);
        border: 1px solid var(--border);
        color: var(--text-secondary);
        padding: 8px 14px;
        border-radius: 20px;
        font-size: 0.85rem;
        cursor: pointer;
        transition: all 0.2s;
        font-family: 'Inter', sans-serif;
    }
    
    .quick-reply:hover {
        border-color: var(--primary);
        color: var(--text-primary);
    }
    
    /* Editor sections */
    .editor-section {
        background: var(--bg-input);
        border: 1px solid var(--border);
        border-radius: 8px;
        margin-bottom: 15px;
        overflow: hidden;
    }
    
    .editor-section-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 15px;
        background: var(--bg-card);
        cursor: pointer;
    }
    
    .editor-section-header h4 {
        font-size: 1rem;
        font-weight: 600;
    }
    
    .editor-section-toggle {
        background: none;
        border: none;
        color: var(--text-secondary);
        cursor: pointer;
        font-size: 1.2rem;
        transition: transform 0.2s;
    }
    
    .editor-section-toggle.open {
        transform: rotate(180deg);
    }
    
    .editor-section-content {
        display: none;
        padding: 15px;
    }
    
    .editor-section-content.show {
        display: block;
    }
    
    .editor-field {
        margin-bottom: 15px;
    }
    
    .editor-field:last-child {
        margin-bottom: 0;
    }
    
    /* Color picker */
    .color-picker-row {
        display: flex;
        align-items: center;
        gap: 12px;
    }
    
    .color-picker {
        width: 50px;
        height: 40px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        background: none;
    }
    
    .color-preview {
        width: 40px;
        height: 40px;
        border-radius: 8px;
        border: 2px solid var(--border);
    }
    
    /* Preview panel */
    .preview-panel {
        background: var(--bg-input);
        border: 1px solid var(--border);
        border-radius: 12px;
        overflow: hidden;
        margin-top: 20px;
    }
    
    .preview-header {
        background: var(--bg-card);
        padding: 12px 16px;
        border-bottom: 1px solid var(--border);
        display: flex;
        align-items: center;
        justify-content: space-between;
    }
    
    .preview-header h4 {
        font-size: 0.9rem;
        color: var(--text-secondary);
    }
    
    .preview-frame {
        height: 400px;
        border: none;
        width: 100%;
    }
    
    /* Loading */
    .loading-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(15, 23, 42, 0.9);
        z-index: 1000;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        gap: 20px;
    }
    
    .loading-overlay.show {
        display: flex;
    }
    
    .loading-spinner {
        width: 50px;
        height: 50px;
        border: 3px solid var(--border);
        border-top-color: var(--primary);
        border-radius: 50%;
        animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
        to { transform: rotate(360deg); }
    }
    
    .loading-text {
        color: var(--text-secondary);
        font-size: 1.1rem;
    }
    
    /* Success screen */
    .success-screen {
        text-align: center;
        padding: 40px 20px;
    }
    
    .success-icon {
        width: 80px;
        height: 80px;
        background: var(--success);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 25px;
        font-size: 2.5rem;
    }
    
    .success-title {
        font-size: 1.8rem;
        font-weight: 700;
        margin-bottom: 10px;
    }
    
    .success-desc {
        color: var(--text-secondary);
        margin-bottom: 30px;
    }
    
    /* Footer */
    footer {
        text-align: center;
        padding: 30px 20px;
        border-top: 1px solid var(--border);
        margin-top: 40px;
        color: var(--text-muted);
        font-size: 0.85rem;
    }
    
    footer a {
        color: var(--primary);
        text-decoration: none;
    }
    
    /* Responsive */
    @media (max-width: 600px) {
        .container {
            padding: 15px;
        }
        
        .card {
            padding: 20px;
        }
        
        .btn-row {
            flex-direction: column;
        }
        
        .btn {
            width: 100%;
        }
        
        .chat-container {
            height: 350px;
        }
    }
</style>
```

</head>
<body>
    <div class="container">
        <header>
            <div class="logo"><span>i</span>Tabs</div>
            <p class="tagline">Turn information into action</p>
        </header>

```
    <!-- Steps Indicator -->
    <div class="steps-indicator">
        <div class="step-dot active" id="step1-dot">1</div>
        <div class="step-line" id="line1"></div>
        <div class="step-dot" id="step2-dot">2</div>
        <div class="step-line" id="line2"></div>
        <div class="step-dot" id="step3-dot">3</div>
        <div class="step-line" id="line3"></div>
        <div class="step-dot" id="step4-dot">4</div>
        <div class="step-line" id="line4"></div>
        <div class="step-dot" id="step5-dot">5</div>
    </div>
    
    <!-- Step 1: API Key -->
    <div class="section active" id="step1">
        <h2 class="section-title">First, your API key</h2>
        <p class="section-desc">We use Google's Gemini AI to organise your content. It's free.</p>
        
        <div class="card">
            <div class="card-title">
                <span class="icon">üîë</span>
                Gemini API Key
            </div>
            
            <div class="api-key-input">
                <input type="password" id="apiKey" placeholder="Paste your Gemini API key">
                <button class="api-key-toggle" onclick="toggleApiKeyVisibility()">üëÅÔ∏è</button>
            </div>
            <p class="input-help">
                Don't have one? <a href="https://aistudio.google.com/app/apikey" target="_blank" class="api-link">Get a free API key from Google AI Studio ‚Üí</a>
            </p>
            
            <div class="btn-row">
                <button class="btn btn-primary" onclick="validateApiKey()">Continue ‚Üí</button>
            </div>
        </div>
    </div>
    
    <!-- Step 2: Paste Content -->
    <div class="section" id="step2">
        <h2 class="section-title">Paste your content</h2>
        <p class="section-desc">Transcript, notes, research, whatever you've got. Messy is fine.</p>
        
        <div class="card">
            <div class="card-title">
                <span class="icon">üìù</span>
                Your Content
            </div>
            
            <textarea id="rawContent" placeholder="Paste your content here...
```

Examples:

- YouTube transcript
- Training notes
- Research you‚Äôve gathered
- Course material
- Meeting notes

Don‚Äôt worry about formatting - AI will organise it.‚Äù></textarea>

```
            <div class="btn-row">
                <button class="btn btn-secondary" onclick="goToStep(1)">‚Üê Back</button>
                <button class="btn btn-primary" onclick="startAIChat()">Let AI Organise This ‚Üí</button>
            </div>
        </div>
    </div>
    
    <!-- Step 3: AI Chat -->
    <div class="section" id="step3">
        <h2 class="section-title">AI is reading your content</h2>
        <p class="section-desc">Answer a few questions so we get the structure right.</p>
        
        <div class="chat-container">
            <div class="chat-messages" id="chatMessages">
                <!-- Messages will appear here -->
            </div>
            <div class="quick-replies" id="quickReplies">
                <!-- Quick reply buttons -->
            </div>
            <div class="chat-input-area">
                <textarea class="chat-input" id="chatInput" placeholder="Type your answer..." rows="1"></textarea>
                <button class="chat-send" onclick="sendChatMessage()">
                    <svg viewBox="0 0 24 24"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>
                </button>
            </div>
        </div>
        
        <div class="btn-row">
            <button class="btn btn-secondary" onclick="goToStep(2)">‚Üê Back</button>
            <button class="btn btn-primary" id="continueToEditor" style="display: none;" onclick="goToStep(4)">Continue to Editor ‚Üí</button>
        </div>
    </div>
    
    <!-- Step 4: Editor -->
    <div class="section" id="step4">
        <h2 class="section-title">Review & edit</h2>
        <p class="section-desc">AI organised your content. Tweak anything that needs adjusting.</p>
        
        <div class="card">
            <div class="card-title">
                <span class="icon">üè¢</span>
                Branding (Optional)
            </div>
            
            <div class="editor-field">
                <label>Business / Guide Name</label>
                <input type="text" id="brandName" placeholder="e.g., VerveX AI, My Training Guide">
            </div>
            
            <div class="editor-field">
                <label>Prepared for (Client Name)</label>
                <input type="text" id="clientName" placeholder="e.g., Sarah Mitchell">
            </div>
            
            <div class="editor-field">
                <label>Brand Color</label>
                <div class="color-picker-row">
                    <input type="color" class="color-picker" id="brandColor" value="#6366f1">
                    <span class="color-preview" id="colorPreview" style="background: #6366f1;"></span>
                    <span style="color: var(--text-secondary);">#6366f1</span>
                </div>
            </div>
            
            <div class="editor-field">
                <label>Contact Email</label>
                <input type="email" id="contactEmail" placeholder="e.g., hello@yourbusiness.com">
            </div>
        </div>
        
        <!-- Dynamic sections will be added here -->
        <div id="editorSections"></div>
        
        <button class="btn btn-secondary" onclick="addSection()" style="margin-bottom: 20px;">+ Add Section</button>
        
        <div class="btn-row">
            <button class="btn btn-secondary" onclick="goToStep(3)">‚Üê Back</button>
            <button class="btn btn-primary" onclick="generatePreview()">Preview iTabs ‚Üí</button>
        </div>
    </div>
    
    <!-- Step 5: Preview & Download -->
    <div class="section" id="step5">
        <h2 class="section-title">Your iTabs is ready!</h2>
        <p class="section-desc">Preview it below, then download when you're happy.</p>
        
        <div class="preview-panel">
            <div class="preview-header">
                <h4>Preview</h4>
                <button class="btn btn-secondary" onclick="goToStep(4)" style="padding: 8px 16px; font-size: 0.85rem;">‚Üê Edit</button>
            </div>
            <iframe class="preview-frame" id="previewFrame"></iframe>
        </div>
        
        <div class="btn-row" style="justify-content: center; margin-top: 30px;">
            <button class="btn btn-success" onclick="downloadiTabs()" style="padding: 18px 40px; font-size: 1.1rem;">
                ‚¨áÔ∏è Download iTabs
            </button>
        </div>
        
        <div class="card" style="margin-top: 30px; text-align: center;">
            <p style="color: var(--text-secondary);">
                Your iTabs is a standalone HTML file. Share it anywhere - email, Slack, your website.
                <br>It works offline, no login required.
            </p>
        </div>
    </div>
    
    <footer>
        <p>Built by <a href="#">iTabs</a> ‚Ä¢ People learn easier and act</p>
    </footer>
</div>

<!-- Loading Overlay -->
<div class="loading-overlay" id="loadingOverlay">
    <div class="loading-spinner"></div>
    <div class="loading-text" id="loadingText">Processing...</div>
</div>

<script>
    // State
    let currentStep = 1;
    let apiKey = '';
    let rawContent = '';
    let extractedData = {
        title: '',
        subtitle: '',
        audience: '',
        sections: []
    };
    let chatHistory = [];
    let chatPhase = 0; // Track conversation progress
    
    // Step Navigation
    function goToStep(step) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.getElementById(`step${step}`).classList.add('active');
        
        // Update dots
        for (let i = 1; i <= 5; i++) {
            const dot = document.getElementById(`step${i}-dot`);
            const line = document.getElementById(`line${i-1}`);
            
            if (i < step) {
                dot.classList.remove('active');
                dot.classList.add('completed');
                dot.innerHTML = '‚úì';
                if (line) line.classList.add('completed');
            } else if (i === step) {
                dot.classList.add('active');
                dot.classList.remove('completed');
                dot.innerHTML = i;
            } else {
                dot.classList.remove('active', 'completed');
                dot.innerHTML = i;
                if (line) line.classList.remove('completed');
            }
        }
        
        currentStep = step;
        window.scrollTo(0, 0);
    }
    
    // API Key
    function toggleApiKeyVisibility() {
        const input = document.getElementById('apiKey');
        input.type = input.type === 'password' ? 'text' : 'password';
    }
    
    function validateApiKey() {
        const key = document.getElementById('apiKey').value.trim();
        if (!key) {
            alert('Please enter your Gemini API key');
            return;
        }
        apiKey = key;
        goToStep(2);
    }
    
    // AI Chat
    async function startAIChat() {
        rawContent = document.getElementById('rawContent').value.trim();
        if (!rawContent) {
            alert('Please paste some content first');
            return;
        }
        
        goToStep(3);
        chatHistory = [];
        chatPhase = 0;
        document.getElementById('chatMessages').innerHTML = '';
        
        // Initial AI message
        showLoading('Reading your content...');
        
        try {
            const response = await callGemini(`You are helping create an iTabs guide. iTabs organises information so people can learn easier and act.
```

I‚Äôm going to give you some content. Read it and:

1. Identify what topic/subject it covers
1. Suggest who this might be for
1. Ask ONE clarifying question to understand what the reader should be able to DO after reading this guide

Be conversational and brief. No bullet points in your response.

Here‚Äôs the content:

${rawContent}`);

```
            hideLoading();
            addChatMessage(response, 'ai');
            chatPhase = 1;
            
            // Add quick replies based on common answers
            showQuickReplies([
                'Training clients',
                'Students learning',
                'My own reference',
                'Team members'
            ]);
            
        } catch (error) {
            hideLoading();
            addChatMessage("Sorry, I couldn't connect to the AI. Please check your API key and try again.", 'ai');
            console.error(error);
        }
    }
    
    function addChatMessage(text, type) {
        const messages = document.getElementById('chatMessages');
        const msg = document.createElement('div');
        msg.className = `chat-message ${type}`;
        msg.textContent = text;
        messages.appendChild(msg);
        messages.scrollTop = messages.scrollHeight;
    }
    
    function showQuickReplies(replies) {
        const container = document.getElementById('quickReplies');
        container.innerHTML = '';
        replies.forEach(reply => {
            const btn = document.createElement('button');
            btn.className = 'quick-reply';
            btn.textContent = reply;
            btn.onclick = () => {
                document.getElementById('chatInput').value = reply;
                sendChatMessage();
            };
            container.appendChild(btn);
        });
    }
    
    async function sendChatMessage() {
        const input = document.getElementById('chatInput');
        const message = input.value.trim();
        if (!message) return;
        
        addChatMessage(message, 'user');
        input.value = '';
        document.getElementById('quickReplies').innerHTML = '';
        
        chatHistory.push({ role: 'user', content: message });
        
        if (chatPhase === 1) {
            // First answer - ask about key actions
            showLoading('Thinking...');
            try {
                const response = await callGemini(`The user said their guide is for: "${message}"
```

Now ask them: What‚Äôs the ONE main thing someone should be able to DO after reading this guide? (Keep it conversational, one question only)`);

```
                hideLoading();
                addChatMessage(response, 'ai');
                chatPhase = 2;
                
                showQuickReplies([
                    'Take immediate action',
                    'Understand and apply concepts',
                    'Follow step-by-step process',
                    'Reference when needed'
                ]);
                
            } catch (error) {
                hideLoading();
                addChatMessage("Sorry, something went wrong. Let's continue anyway.", 'ai');
                chatPhase = 2;
            }
            
        } else if (chatPhase === 2) {
            // Second answer - now extract structure
            showLoading('Organising your content...');
            try {
                const response = await callGemini(`Based on our conversation:
```

- Content is for: ${chatHistory[0]?.content || ‚Äògeneral audience‚Äô}
- Main goal: ${message}

Now organize the original content into an iTabs structure. Return ONLY valid JSON in this exact format:
{
‚Äútitle‚Äù: ‚ÄúGuide title‚Äù,
‚Äúsubtitle‚Äù: ‚ÄúBrief description‚Äù,
‚Äúsections‚Äù: [
{
‚Äúnumber‚Äù: 1,
‚Äútitle‚Äù: ‚ÄúSection Title‚Äù,
‚Äúbadge‚Äù: ‚ÄúOverview‚Äù,
‚Äútabs‚Äù: [
{
‚Äúname‚Äù: ‚ÄúTab Name‚Äù,
‚Äúcontent‚Äù: ‚ÄúTab content here. Can include **bold** for emphasis.‚Äù
}
],
‚ÄúkeyPoint‚Äù: {
‚Äúlabel‚Äù: ‚ÄúKey Insight‚Äù,
‚Äútext‚Äù: ‚ÄúThe main takeaway‚Äù
}
}
]
}

Create 3-5 sections. Each section should have 2-3 tabs. Focus on ACTION - what they should DO.

Original content:
${rawContent}`);

```
                hideLoading();
                
                // Try to parse the JSON
                try {
                    // Extract JSON from response (might have markdown code blocks)
                    let jsonStr = response;
                    const jsonMatch = response.match(/```json?\s*([\s\S]*?)```/);
                    if (jsonMatch) {
                        jsonStr = jsonMatch[1];
                    }
                    
                    extractedData = JSON.parse(jsonStr);
                    
                    addChatMessage("Great! I've organised your content into sections. Click 'Continue to Editor' to review and make any changes.", 'ai');
                    
                    document.getElementById('continueToEditor').style.display = 'inline-flex';
                    
                } catch (parseError) {
                    console.error('JSON parse error:', parseError);
                    addChatMessage("I've analysed your content. Click 'Continue to Editor' to see the structure and make adjustments.", 'ai');
                    
                    // Create default structure
                    extractedData = {
                        title: "Your Guide",
                        subtitle: "Created with iTabs",
                        sections: [
                            {
                                number: 1,
                                title: "Overview",
                                badge: "Start",
                                tabs: [
                                    { name: "Summary", content: rawContent.substring(0, 500) + "..." }
                                ],
                                keyPoint: { label: "Key Point", text: "Edit this section" }
                            }
                        ]
                    };
                    
                    document.getElementById('continueToEditor').style.display = 'inline-flex';
                }
                
                chatPhase = 3;
                
            } catch (error) {
                hideLoading();
                console.error(error);
                addChatMessage("I had trouble organising the content, but let's continue. You can edit everything in the next step.", 'ai');
                document.getElementById('continueToEditor').style.display = 'inline-flex';
            }
        }
    }
    
    // Gemini API Call
    async function callGemini(prompt) {
        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                contents: [{
                    parts: [{ text: prompt }]
                }],
                generationConfig: {
                    temperature: 0.7,
                    maxOutputTokens: 4096,
                }
            })
        });
        
        if (!response.ok) {
            throw new Error('API request failed');
        }
        
        const data = await response.json();
        return data.candidates[0].content.parts[0].text;
    }
    
    // Editor
    function goToStep4() {
        goToStep(4);
        populateEditor();
    }
    
    // Override goToStep for step 4 to populate editor
    const originalGoToStep = goToStep;
    goToStep = function(step) {
        originalGoToStep(step);
        if (step === 4) {
            populateEditor();
        }
    };
    
    function populateEditor() {
        document.getElementById('brandName').value = extractedData.title || '';
        
        const container = document.getElementById('editorSections');
        container.innerHTML = '';
        
        if (extractedData.sections) {
            extractedData.sections.forEach((section, index) => {
                addSectionToEditor(section, index);
            });
        }
    }
    
    function addSectionToEditor(section = null, index = null) {
        const container = document.getElementById('editorSections');
        const sectionIndex = index !== null ? index : container.children.length;
        
        const sectionEl = document.createElement('div');
        sectionEl.className = 'editor-section';
        sectionEl.innerHTML = `
            <div class="editor-section-header" onclick="toggleEditorSection(this)">
                <h4>Section ${sectionIndex + 1}: <span class="section-title-display">${section?.title || 'New Section'}</span></h4>
                <button class="editor-section-toggle">‚ñº</button>
            </div>
            <div class="editor-section-content">
                <div class="editor-field">
                    <label>Section Title</label>
                    <input type="text" class="section-title-input" value="${section?.title || ''}" placeholder="e.g., Getting Started" onchange="updateSectionTitle(this)">
                </div>
                <div class="editor-field">
                    <label>Badge</label>
                    <input type="text" class="section-badge-input" value="${section?.badge || ''}" placeholder="e.g., Overview, Learn, Do">
                </div>
                <div class="editor-field">
                    <label>Content</label>
                    <textarea class="section-content-input" rows="6" placeholder="Section content...">${section?.tabs?.[0]?.content || ''}</textarea>
                </div>
                <div class="editor-field">
                    <label>Key Point (optional)</label>
                    <input type="text" class="section-keypoint-input" value="${section?.keyPoint?.text || ''}" placeholder="The main takeaway from this section">
                </div>
                <button class="btn btn-secondary" onclick="removeSection(this)" style="margin-top: 10px; padding: 8px 16px; font-size: 0.85rem; color: var(--error);">Remove Section</button>
            </div>
        `;
        
        container.appendChild(sectionEl);
    }
    
    function addSection() {
        addSectionToEditor();
    }
    
    function removeSection(btn) {
        if (confirm('Remove this section?')) {
            btn.closest('.editor-section').remove();
        }
    }
    
    function toggleEditorSection(header) {
        const content = header.nextElementSibling;
        const toggle = header.querySelector('.editor-section-toggle');
        content.classList.toggle('show');
        toggle.classList.toggle('open');
    }
    
    function updateSectionTitle(input) {
        const display = input.closest('.editor-section').querySelector('.section-title-display');
        display.textContent = input.value || 'New Section';
    }
    
    // Color picker
    document.getElementById('brandColor').addEventListener('input', function() {
        document.getElementById('colorPreview').style.background = this.value;
    });
    
    // Generate Preview
    function generatePreview() {
        const html = generateiTabsHTML();
        const frame = document.getElementById('previewFrame');
        frame.srcdoc = html;
        goToStep(5);
    }
    
    function generateiTabsHTML() {
        // Collect data from editor
        const brandName = document.getElementById('brandName').value || 'My Guide';
        const clientName = document.getElementById('clientName').value || '';
        const brandColor = document.getElementById('brandColor').value;
        const contactEmail = document.getElementById('contactEmail').value;
        
        const sections = [];
        document.querySelectorAll('.editor-section').forEach((el, index) => {
            sections.push({
                number: index + 1,
                title: el.querySelector('.section-title-input').value || `Section ${index + 1}`,
                badge: el.querySelector('.section-badge-input').value || 'Info',
                content: el.querySelector('.section-content-input').value || '',
                keyPoint: el.querySelector('.section-keypoint-input').value || ''
            });
        });
        
        // Generate HTML
        return `<!DOCTYPE html>
```

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${brandName}</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --brand-primary: ${brandColor};
            --brand-secondary: ${adjustColor(brandColor, -20)};
            --bg-dark: #0f172a;
            --bg-card: #1e293b;
            --bg-hover: #334155;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --border: #334155;
            --success: #10b981;
        }

```
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
        font-family: 'Inter', sans-serif;
        background: var(--bg-dark);
        color: var(--text-primary);
        min-height: 100vh;
        padding: 20px;
        line-height: 1.6;
    }
    
    .container { max-width: 800px; margin: 0 auto; }
    
    header {
        text-align: center;
        padding: 40px 20px;
        border-bottom: 1px solid var(--border);
        margin-bottom: 30px;
    }
    
    .brand-logo {
        font-size: 1.2rem;
        font-weight: 700;
        color: var(--brand-primary);
        margin-bottom: 15px;
    }
    
    h1 {
        font-size: 2rem;
        font-weight: 700;
        margin-bottom: 10px;
        background: linear-gradient(135deg, var(--brand-primary), var(--brand-secondary));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }
    
    .subtitle { color: var(--text-secondary); }
    
    .client-badge {
        display: inline-block;
        background: var(--bg-card);
        border: 1px solid var(--brand-primary);
        color: var(--brand-primary);
        padding: 6px 16px;
        border-radius: 20px;
        font-size: 0.85rem;
        margin-top: 15px;
    }
    
    .itab-section {
        background: var(--bg-card);
        border-radius: 12px;
        margin-bottom: 16px;
        overflow: hidden;
        border: 1px solid var(--border);
    }
    
    .itab-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 20px;
        cursor: pointer;
        transition: background 0.2s;
    }
    
    .itab-header:hover { background: var(--bg-hover); }
    
    .itab-title { display: flex; align-items: center; gap: 15px; }
    
    .itab-number {
        width: 36px;
        height: 36px;
        background: linear-gradient(135deg, var(--brand-primary), var(--brand-secondary));
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        color: white;
    }
    
    .itab-name { font-size: 1.1rem; font-weight: 600; }
    
    .itab-badge {
        font-size: 0.7rem;
        padding: 4px 10px;
        border-radius: 20px;
        background: var(--bg-hover);
        color: var(--text-secondary);
        text-transform: uppercase;
    }
    
    .i-button {
        width: 32px;
        height: 32px;
        background: linear-gradient(135deg, var(--brand-primary), var(--brand-secondary));
        border: none;
        border-radius: 8px;
        color: white;
        font-weight: 700;
        cursor: pointer;
        font-family: serif;
        font-style: italic;
    }
    
    .i-button.active { background: var(--success); }
    
    .itab-content {
        display: none;
        padding: 20px;
        border-top: 1px solid var(--border);
    }
    
    .itab-content.show { display: block; }
    
    .itab-content p { color: var(--text-secondary); margin-bottom: 15px; white-space: pre-wrap; }
    
    .key-point {
        background: var(--bg-dark);
        border-left: 4px solid var(--brand-primary);
        padding: 15px 20px;
        margin-top: 15px;
        border-radius: 0 8px 8px 0;
    }
    
    .key-point .label {
        color: var(--brand-primary);
        font-weight: 600;
        font-size: 0.85rem;
        margin-bottom: 5px;
    }
    
    .key-point p { color: var(--text-primary); margin-bottom: 0; }
    
    .support-box {
        background: var(--bg-card);
        border-radius: 12px;
        padding: 25px;
        text-align: center;
        margin-top: 30px;
    }
    
    .support-box h3 { color: var(--brand-primary); margin-bottom: 10px; }
    
    .support-link {
        display: inline-block;
        background: linear-gradient(135deg, var(--brand-primary), var(--brand-secondary));
        color: white;
        padding: 12px 30px;
        border-radius: 8px;
        text-decoration: none;
        font-weight: 600;
        margin-top: 15px;
    }
    
    footer {
        text-align: center;
        padding: 30px;
        border-top: 1px solid var(--border);
        margin-top: 30px;
        color: var(--text-secondary);
        font-size: 0.85rem;
    }
    
    footer a { color: var(--brand-primary); text-decoration: none; }
</style>
```

</head>
<body>
    <div class="container">
        <header>
            <div class="brand-logo">${brandName}</div>
            <h1>${extractedData.subtitle || 'Your Guide'}</h1>
            <p class="subtitle">Organised so you can learn and act</p>
            ${clientName ? `<span class="client-badge">Prepared for: ${clientName}</span>` : ''}
        </header>

```
    ${sections.map(section => `
    <div class="itab-section">
        <div class="itab-header" onclick="toggleSection(this)">
            <div class="itab-title">
                <span class="itab-number">${section.number}</span>
                <span class="itab-name">${section.title}</span>
                <span class="itab-badge">${section.badge}</span>
            </div>
            <button class="i-button">i</button>
        </div>
        <div class="itab-content">
            <p>${section.content.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')}</p>
            ${section.keyPoint ? `
            <div class="key-point">
                <div class="label">üí° Key Point</div>
                <p>${section.keyPoint}</p>
            </div>
            ` : ''}
        </div>
    </div>
    `).join('')}
    
    ${contactEmail ? `
    <div class="support-box">
        <h3>Need Help?</h3>
        <p style="color: var(--text-secondary);">Questions about anything in this guide?</p>
        <a href="mailto:${contactEmail}" class="support-link">Get in Touch ‚Üí</a>
    </div>
    ` : ''}
    
    <footer>
        <p>Created with <a href="https://itabs.ai">iTabs</a> ‚Ä¢ People learn easier and act</p>
    </footer>
</div>

<script>
    function toggleSection(header) {
        const content = header.nextElementSibling;
        const button = header.querySelector('.i-button');
        content.classList.toggle('show');
        button.classList.toggle('active');
    }
    
    // Open first section
    document.querySelector('.itab-header')?.click();
</script>
```

</body>
</html>`;
        }

```
    // Color adjustment helper
    function adjustColor(hex, percent) {
        const num = parseInt(hex.replace('#', ''), 16);
        const amt = Math.round(2.55 * percent);
        const R = (num >> 16) + amt;
        const G = (num >> 8 & 0x00FF) + amt;
        const B = (num & 0x0000FF) + amt;
        return '#' + (0x1000000 + (R < 255 ? R < 1 ? 0 : R : 255) * 0x10000 +
            (G < 255 ? G < 1 ? 0 : G : 255) * 0x100 +
            (B < 255 ? B < 1 ? 0 : B : 255))
            .toString(16).slice(1);
    }
    
    // Download
    function downloadiTabs() {
        const html = generateiTabsHTML();
        const blob = new Blob([html], { type: 'text/html' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `${document.getElementById('brandName').value || 'itabs-guide'}.html`.replace(/\s+/g, '-').toLowerCase();
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    }
    
    // Loading
    function showLoading(text) {
        document.getElementById('loadingText').textContent = text;
        document.getElementById('loadingOverlay').classList.add('show');
    }
    
    function hideLoading() {
        document.getElementById('loadingOverlay').classList.remove('show');
    }
    
    // Chat input enter key
    document.getElementById('chatInput').addEventListener('keydown', function(e) {
        if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            sendChatMessage();
        }
    });
</script>
```

</body>
</html>
